<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="TeamSorting.Views.InputView"
             x:DataType="viewModel:InputViewModel"
             xmlns:viewModel="clr-namespace:TeamSorting.ViewModels"
             xmlns:i="https://github.com/projektanker/icons.avalonia"
             xmlns:lang="clr-namespace:TeamSorting.Lang"
             xmlns:converter="clr-namespace:TeamSorting.Converters"
             xmlns:models="clr-namespace:TeamSorting.Models">
    <UserControl.Resources>
        <x:Double x:Key="DataGridSortIconMinWidth">0</x:Double>
        <converter:EnumDisplayNameConvertor x:Key="EnumDisplayNameConvertor" />
    </UserControl.Resources>

    <UserControl.Styles>
        <Style Selector="MenuFlyoutPresenter.MemberSelectorFlyout">
            <Setter Property="MaxHeight" Value="300" />
        </Style>
    </UserControl.Styles>

    <Grid RowDefinitions="Auto,*,40"
          VerticalAlignment="Stretch"
          HorizontalAlignment="Stretch">
        <DockPanel Grid.Row="0"
                   HorizontalAlignment="Stretch"
                   DockPanel.Dock="Top">
            <DockPanel>
                <Button DockPanel.Dock="Top"
                        Click="LoadData_OnClick"
                        HorizontalAlignment="Left"
                        VerticalAlignment="Top"
                        Content="{x:Static lang:Resources.InputView_LoadData_Button}" />
                <DockPanel HorizontalAlignment="Left"
                           VerticalAlignment="Bottom"
                           DockPanel.Dock="Bottom">
                    <TextBox Text="{Binding NewDisciplineName}"
                             Watermark="{x:Static lang:Resources.InputView_NewDiscipline_Watermark}"
                             Width="200"
                             KeyDown="AddDisciplineTextBox_OnKeyDown"
                             DockPanel.Dock="Left" />
                    <ComboBox ItemsSource="{Binding DisciplineDataTypes}"
                              x:Name="DisciplineTypeComboBox"
                              Loaded="ComboBox_OnLoaded">
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding ., Converter={StaticResource EnumDisplayNameConvertor}}"/>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>
                    <ComboBox ItemsSource="{Binding SortOrder}"
                              x:Name="DisciplineSortOrderComboBox"
                              Loaded="ComboBox_OnLoaded">
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding ., Converter={StaticResource EnumDisplayNameConvertor}}"/>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>
                    <Button VerticalAlignment="Center"
                            Click="AddDisciplineButton_OnClick"
                            Content="{x:Static lang:Resources.InputView_AddDiscipline_Button}">
                    </Button>
                </DockPanel>
            </DockPanel>
            <StackPanel Orientation="Vertical"
                        HorizontalAlignment="Right"
                        Spacing="5">
                <Button Click="ShowTeamsButton_OnClick"
                        HorizontalAlignment="Right"
                        IsVisible="False"
                        Content="{x:Static lang:Resources.InputView_ShowTeams_Button}"/>
                <NumericUpDown x:Name="NumberOfTeams"
                               Value="{Binding NumberOfTeams}"
                               FormatString="0"
                               Minimum="1"
                               Maximum="10" />
                <TextBox MaxLength="10"
                         Watermark="{x:Static lang:Resources.InputView_Seed_Watermark}"
                         Text="{Binding Data.InputSeed}" />
                <Button Click="SortToTeams_OnClick"
                        Content="{x:Static lang:Resources.InputView_SortToTeams_Button}" />
            </StackPanel>
        </DockPanel>


        <DataGrid Grid.Row="1"
                  ItemsSource="{Binding Data.Members}"
                  CanUserSortColumns="False"
                  AutoGenerateColumns="False"
                  CanUserResizeColumns="True"
                  GridLinesVisibility="Horizontal"
                  HorizontalAlignment="Stretch"
                  VerticalAlignment="Stretch"
                  DockPanel.Dock="Top"
                  FrozenColumnCount="2"
                  VerticalScrollBarVisibility="Auto"
                  HorizontalScrollBarVisibility="Auto"
                  x:Name="MemberGrid">
            <DataGrid.Styles>
                <Style Selector="DataGridColumnHeader">
                    <Setter Property="Padding" Value="12,0"></Setter>
                </Style>
            </DataGrid.Styles>
            <DataGrid.Columns>
                <DataGridTemplateColumn>
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Button Click="RemoveMemberButton_OnClick"
                                    ToolTip.Tip="{x:Static lang:Resources.InputView_RemoveMember_Button_Tooltip}"
                                    i:Attached.Icon="mdi-close" />
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridTextColumn Header="{x:Static lang:Resources.InputView_DataGrid_ColumnHeader_Name}"
                                    Binding="{Binding Name}" />
                <DataGridTemplateColumn Header="{x:Static lang:Resources.InputView_DataGrid_ColumnHeader_With}">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <StackPanel>
                                <Button i:Attached.Icon="mdi-plus">
                                    <Button.Flyout>
                                        <MenuFlyout FlyoutPresenterClasses="MemberSelectorFlyout"
                                                    ItemsSource="{Binding $parent[UserControl].((viewModel:InputViewModel)DataContext).Data.SortedMembers}">
                                            <MenuFlyout.ItemTemplate>
                                                <DataTemplate>
                                                    <DataTemplate.DataType>
                                                        <x:Type TypeName="models:Member"></x:Type>
                                                    </DataTemplate.DataType>
                                                    <MenuItem Header="{Binding Name}"
                                                              Click="AddWithMemberMenuItem_OnClick" />
                                                </DataTemplate>
                                            </MenuFlyout.ItemTemplate>
                                        </MenuFlyout>
                                    </Button.Flyout>
                                </Button>
                                <ItemsControl ItemsSource="{Binding SortedWith}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <WrapPanel Orientation="Horizontal" />
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Padding="2"
                                                    BorderThickness="1"
                                                    BorderBrush="Black"
                                                    CornerRadius="5"
                                                    Margin="3">
                                                <StackPanel Orientation="Horizontal">
                                                    <Button i:Attached.Icon="mdi-close"
                                                            Padding="2"
                                                            Margin="0,0,3,0"
                                                            Click="RemoveWithMemberButton_OnClick" />
                                                    <TextBlock Text="{Binding Name}"
                                                               VerticalAlignment="Center" />
                                                </StackPanel>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridTemplateColumn Header="{x:Static lang:Resources.InputView_DataGrid_ColumnHeader_NotWith}">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <StackPanel>
                                <Button i:Attached.Icon="mdi-plus">
                                    <Button.Flyout>
                                        <MenuFlyout FlyoutPresenterClasses="MemberSelectorFlyout"
                                                    ItemsSource="{Binding $parent[UserControl].((viewModel:InputViewModel)DataContext).Data.SortedMembers}">
                                            <MenuFlyout.ItemTemplate>
                                                <DataTemplate>
                                                    <DataTemplate.DataType>
                                                        <x:Type TypeName="models:Member"></x:Type>
                                                    </DataTemplate.DataType>
                                                    <MenuItem Header="{Binding Name}"
                                                              Click="AddNotWithMemberMenuItem_OnClick" />
                                                </DataTemplate>
                                            </MenuFlyout.ItemTemplate>
                                        </MenuFlyout>
                                    </Button.Flyout>
                                </Button>
                                <ItemsControl ItemsSource="{Binding SortedNotWith}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <WrapPanel Orientation="Horizontal" />
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Padding="2"
                                                    BorderThickness="1"
                                                    BorderBrush="Black"
                                                    CornerRadius="5"
                                                    Margin="3">
                                                <StackPanel Orientation="Horizontal">
                                                    <Button i:Attached.Icon="mdi-close"
                                                            Padding="2"
                                                            Margin="0,0,3,0"
                                                            Click="RemoveNotWithMemberButton_OnClick" />
                                                    <TextBlock Text="{Binding Name}"
                                                               VerticalAlignment="Center" />
                                                </StackPanel>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>
        <DockPanel Grid.Row="2"
                   VerticalAlignment="Center">
            <TextBox Text="{Binding NewMemberName}"
                     Watermark="{x:Static lang:Resources.InputView_NewMember_TextBox_Watermark}"
                     IsVisible="True"
                     Width="200"
                     KeyDown="NewMemberTextBox_OnKeyDown"
                     DockPanel.Dock="Left" />
            <Button VerticalAlignment="Center"
                    Click="NewMemberTextBox_OnClick"
                    Content="{x:Static lang:Resources.InputView_NewMember_Button}" />
        </DockPanel>
    </Grid>
</UserControl>